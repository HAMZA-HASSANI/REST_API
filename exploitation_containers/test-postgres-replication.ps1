# Variables
$primary = "postgres-1"
$replica = "postgres-2"
$dbUser = "admin"
$dbName = "postgresdb"

# SQL à exécuter sur le primaire
$sql = @"
CREATE TABLE IF NOT EXISTS customers (
    firstname TEXT,
    customer_id SERIAL,
    date_created TIMESTAMP
);
INSERT INTO customers (firstname, date_created) 
VALUES ('Bob', NOW()), ('Charlie', NOW());
SELECT * FROM customers;
"@

# Créer la table et insérer les données
Write-Host "Création de la table sur le primaire ($primary)..."
docker exec -i $primary psql -U $dbUser -d $dbName -c $sql

# Pause pour laisser le temps à la réplication
Start-Sleep -Seconds 5

# Vérifier sur le réplicat
Write-Host "Vérification de la réplication sur le réplicat ($replica)..."
docker exec -i $replica psql -U $dbUser -d $dbName -c 'SELECT * FROM customers;'
